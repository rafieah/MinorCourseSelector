<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minor Course Selection</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* Changed to pure white */
            /* Removed background-image linear-gradient */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center vertically */
            align-items: center;
            min-height: 100vh;
            padding: 24px;
            box-sizing: border-box;
        }
        .header-section {
            text-align: center;
            margin-bottom: 40px; /* More space below header */
            color: #2c3e50;
        }
        .header-section img {
            max-width: 500px; /* Estimated width to visually match the title */
            width: 100%; /* Ensure it's responsive and scales down */
            height: auto;
            margin: 0 auto 15px auto; /* Center the image horizontally and add space below */
            display: block; /* Make it a block element to apply margin auto */
        }
        .header-section h1 {
            font-size: 2.75rem; /* Larger main title */
            font-weight: 800; /* Extra bold */
            color: #2c3e50; /* Dark blue/grey for title */
            margin-bottom: 8px;
            letter-spacing: -0.025em; /* Slightly tighter letter spacing */
            max-width: 500px; /* Constrain the text width to match the logo */
            margin-left: auto; /* Center the h1 */
            margin-right: auto; /* Center the h1 */
        }
        .header-section p {
            font-size: 1.15rem; /* Larger subtitle */
            color: #607d8b; /* Softer grey for subtitle */
        }
        .container {
            max-width: 1080px; /* Increased max-width for wider fields */
            width: 100%;
            background-color: #ffffff;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12); /* Deeper, more noticeable shadow */
            transition: all 0.3s ease-in-out; /* Smooth transition for section changes */
        }
        h2 { /* For section titles like "1. Enter Your Details" */
            font-size: 1.6rem; /* Slightly smaller than main title but prominent */
            font-weight: 700; /* Bold */
            color: #344054;
            margin-bottom: 32px;
            border-bottom: 1px solid #e0e7ee; /* Subtle separator line */
            padding-bottom: 16px; /* Padding below separator */
        }
        h3 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 28px;
        }
        .form-row {
            display: flex;
            gap: 24px; /* Space between side-by-side inputs */
            margin-bottom: 28px;
        }
        .form-row .form-group {
            flex: 1; /* Make form groups take equal width */
            margin-bottom: 0; /* Reset margin for inner groups */
        }
        .form-group {
            margin-bottom: 28px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #4a5568; /* Adjusted label color */
            font-size: 0.95rem; /* Slightly smaller label font for consistency with image */
        }
        input, select {
            width: 100%;
            padding: 48px 14px; /* Significantly increased vertical padding (top/bottom) */
            border: 1px solid #cbd5e0;
            border-radius: 8px; /* Slightly less rounded inputs */
            box-sizing: border-box;
            font-size: 16px;
            color: #2d3748;
            background-color: #f9fafb; /* Light grey background for inputs */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.04); /* More subtle inner shadow */
        }
        input:focus, select:focus {
            outline: none;
            border-color: #6366f1; /* Main accent color */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Softer focus shadow */
        }
        .course-card {
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: #ffffff; /* White background for course cards */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100px;
        }
        .course-card .course-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1rem;
            margin-bottom: 6px;
        }
        .course-card .offered-by {
            font-size: 0.9rem;
            color: #718096;
        }
        .course-card.selected {
            border-color: #6366f1;
            background-color: #eef2ff;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.15);
            color: #1a202c;
            transform: translateY(-2px);
        }
        .course-card.hidden { /* Added for hiding unselected courses */
            display: none !important;
        }
        .button {
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem; /* Standard button font size */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1); /* Softer button shadow */
        }
        .button-primary {
            background-color: #6366f1; /* Primary purple */
            color: #ffffff;
        }
        .button-primary:hover {
            background-color: #4f46e5;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        }
        .button-primary:active {
            background-color: #4338ca;
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .button-secondary {
            background-color: #e0e7ff; /* Light purple */
            color: #4f46e5; /* Darker purple text */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        .button-secondary:hover {
            background-color: #c7d2fe;
            transform: translateY(-1px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        .button-secondary:active {
            background-color: #a5b4fc;
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .error-message {
            color: #ef4444; /* Standard red for errors */
            font-size: 0.875rem; /* text-sm */
            margin-top: 6px;
            font-weight: 500;
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            min-width: 300px;
            max-width: 90%;
            border: 1px solid #e5e7eb;
        }
        .message-box h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }
        .message-box p {
            font-size: 16px;
            margin-bottom: 25px;
            color: #555;
        }
        .message-box button {
            background-color: #6366f1; /* Consistent primary color for message box button */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease-in-out;
        }
        .message-box button:hover {
            background-color: #4f46e5;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0; /* Remove gap for column layout */
            }
            .form-row .form-group {
                margin-bottom: 28px; /* Restore margin for column layout */
            }
            .container {
                padding: 24px; /* Adjust padding for smaller screens */
            }
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #printableArea, #printableArea * {
                visibility: visible;
            }
            #printableArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                box-sizing: border-box;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="header-section">
        <img src="https://www.providencecollegecalicut.ac.in/wp-content/uploads/2024/12/pwc-logo-left.png" alt="Providence Women's College Logo" onerror="this.onerror=null;this.src='https://placehold.co/120x120/E0E7FF/4F46E5?text=Logo';" />
        <h1>Minor Course Selector</h1>
        <p>Providence Women's College (Autonomous), Kozhikode</p>
    </div>

    <div class="container">
        <div id="studentDetailsForm" class="no-print">
            <h2>1. Enter Your Details</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="studentName">Student Name</label>
                    <input type="text" id="studentName" placeholder="">
                    <p id="nameError" class="error-message hidden">Please enter your name.</p>
                </div>
                <div class="form-group">
                    <label for="admissionNumber">Admission Number</label>
                    <input type="text" id="admissionNumber" placeholder="">
                    <p id="admissionError" class="error-message hidden">Please enter your admission number.</p>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" id="phoneNumber" placeholder="">
                    <p id="phoneError" class="error-message hidden">Please enter a valid 10-digit phone number.</p>
                </div>
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="">
                    <p id="emailError" class="error-message hidden">Please enter a valid email address.</p>
                </div>
            </div>
            <div class="form-group">
                <label for="department">Major Department</label>
                <select id="department">
                    <option value="">-- Choose your department --</option>
                </select>
                <p id="departmentError" class="error-message hidden">Please select your department.</p>
            </div>
        </div>

        <div id="courseSelectionSection" class="hidden no-print">
            <h3>2. Select Your Minor Courses (Select two)</h3>
            <div id="availableCourses" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <!-- Courses will be loaded here -->
            </div>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                <button id="submitBtn" class="button button-primary hidden">Submit Selection</button>
                <button id="changeOptionsBtn" class="button button-secondary hidden">Change Options</button>
                <button id="changeDepartmentBtn" class="button button-secondary">Change Department</button>
            </div>
        </div>

        <div id="submissionMessage" class="hidden text-center mt-8">
            <h3 class="text-2xl font-semibold text-green-700 mb-4">Your selection has been submitted successfully!</h3>
            <p class="text-gray-600 mb-6">You can now print your details if needed.</p>
            <div class="flex justify-center">
                <button id="printBtn" class="button button-secondary no-print">
                    Print Confirmation
                </button>
            </div>
        </div>

        <!-- Printable Area -->
        <div id="printableArea" class="hidden">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">Minor Course Selection Confirmation</h2>
            <div class="mb-4">
                <p class="text-lg font-semibold">Student Name: <span id="printName" class="font-normal"></span></p>
                <p class="text-lg font-semibold">Admission Number: <span id="printAdmissionNumber" class="font-normal"></span></p>
                <p class="text-lg font-semibold">Phone Number: <span id="printPhone" class="font-normal"></span></p>
                <p class="text-lg font-semibold">Email: <span id="printEmail" class="font-normal"></span></p>
                <p class="text-lg font-semibold">Department: <span id="printDepartment" class="font-normal"></span></p>
            </div>
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Selected Minor Courses:</h3>
            <ul id="printCourses" class="list-disc list-inside text-lg text-gray-700"></ul>
        </div>
    </div>

    <!-- Custom Message Box -->
    <div id="messageOverlay" class="overlay hidden"></div>
    <div id="messageBox" class="message-box hidden">
        <h3 id="messageBoxTitle"></h3>
        <p id="messageBoxContent"></p>
        <button id="messageBoxClose">OK</button>
    </div>

    <script type="module">
        // Minor courses data based on the provided image
        const minorCoursesData = [
            { department: "BBA", minors: ["Communicating with Financial Data", "Marketing Management"] },
            { department: "Botany", minors: ["Plant Ecology, Conservation & Plant Interactions"] },
            { department: "Chemistry", minors: ["Basic Inorganic and Nano Chemistry", "Basic Inorganic and Bio-Inorganic Chemistry", "Basic Inorganic and Green Chemistry"] },
            { department: "Commerce", minors: ["Essentials of Marketing", "Advertisement and Sales Promotion"] },
            { department: "B.Com Professional with ACCA", minors: ["Fundamentals of Entrepreneurship", "Entrepreneurial Marketing"] },
            { department: "Computer Science", minors: ["Python Programming"] },
            { department: "Economics", minors: ["Sectoral Contributions in Indian Economy", "Development Issues in Indian Economy", "Fiscal tools for policy Stabilisation"] },
            { department: "English", minors: ["Fundamentals of content creation", "The Language of Digital Space: English and New Media"] },
            { department: "Hindi", minors: ["Anuvad- Prakriya Aur Pravidhi"] },
            { department: "History", minors: ["Food - A Global Perspective", "Gender History", "Introduction to Historical Tourism"] },
            { department: "HRM", minors: ["Front Office Management", "Management Principles and Business Ethics"] },
            { department: "Political Science", minors: ["Human Rights", "Introduction to International Politics", "A Preface to Indian Constitution"] },
            { department: "Mathematics", minors: ["Mathematical Logic, Set Theory and Combinatorics", "Calculus"] },
            { department: "Malayalam", minors: ["കവിതയും സാഹിത്യം"] },
            { department: "Physics", minors: ["Properties of Matter and Thermodynamics", "Mechanics and Optics"] },
            { department: "Psychology", minors: ["Gateway to Mind and Behaviour", "Basic in Cellular Physiology"] },
            { department: "Statistics", minors: ["Descriptive Statistics for Data Science", "Descriptive statistics", "Introductory Statistics with R"] },
            { department: "Social Work", minors: ["Social Analysis and Strategies of Social Change", "Fundamentals of Professional Social Work"] },
            { department: "TTM", minors: ["Fundamentals of Tourism", "Tourism Business"] },
            { department: "Zoology", minors: ["Foundations of Environmental Biology & Animal Behaviour"] }
        ];

        let selectedDepartment = '';
        let selectedCourses = [];
        let studentInfo = {}; // Object to store student details for printing

        // A map to quickly find which department offers a specific minor course
        const courseToDepartmentMap = {};
        minorCoursesData.forEach(deptData => {
            deptData.minors.forEach(minor => {
                // Handle cases where a minor might be offered by multiple departments by picking the first one
                if (!courseToDepartmentMap[minor]) {
                    courseToDepartmentMap[minor] = deptData.department;
                }
            });
        });

        // UI Elements
        const studentDetailsForm = document.getElementById('studentDetailsForm');
        const courseSelectionSection = document.getElementById('courseSelectionSection');
        const submissionMessage = document.getElementById('submissionMessage');
        const printableArea = document.getElementById('printableArea');

        const studentNameInput = document.getElementById('studentName');
        const admissionNumberInput = document.getElementById('admissionNumber'); // New input
        const phoneNumberInput = document.getElementById('phoneNumber');
        const emailInput = document.getElementById('email');
        const departmentSelect = document.getElementById('department');

        const availableCoursesDiv = document.getElementById('availableCourses');
        const submitBtn = document.getElementById('submitBtn');
        const changeOptionsBtn = document.getElementById('changeOptionsBtn');
        const changeDepartmentBtn = document.getElementById('changeDepartmentBtn');
        const printBtn = document.getElementById('printBtn');

        // Error message elements
        const nameError = document.getElementById('nameError');
        const admissionError = document.getElementById('admissionError'); // New error element
        const phoneError = document.getElementById('phoneError');
        const emailError = document.getElementById('emailError');
        const departmentError = document.getElementById('departmentError');

        // Message box elements
        const messageOverlay = document.getElementById('messageOverlay');
        const messageBox = document.getElementById('messageBox');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const messageBoxClose = document.getElementById('messageBoxClose');

        /**
         * Displays a custom message box to the user.
         * @param {string} title - The title of the message box.
         * @param {string} message - The content message.
         * @param {boolean} [isError=false] - True if it's an error message, changes title color.
         */
        function showMessage(title, message, isError = false) {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBoxTitle.style.color = isError ? '#ef4444' : '#6366f1'; /* Adjusted colors for messages */
            messageOverlay.classList.remove('hidden');
            messageBox.classList.remove('hidden');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessage() {
            messageOverlay.classList.add('hidden');
            messageBox.classList.add('hidden');
        }

        /**
         * Validates an email address.
         * @param {string} email - The email string to validate.
         * @returns {boolean} True if the email is valid, false otherwise.
         */
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }

        /**
         * Validates a 10-digit phone number.
         * @param {string} phone - The phone number string to validate.
         * @returns {boolean} True if the phone number is valid, false otherwise.
         */
        function validatePhoneNumber(phone) {
            const re = /^\d{10}$/; // Assumes a 10-digit phone number
            return re.test(String(phone));
        }

        /**
         * Validates the student details form fields.
         * Shows error messages next to invalid fields.
         * @returns {boolean} True if all fields are valid, false otherwise.
         */
        function validateForm() {
            let isValid = true;

            // Clear previous errors
            nameError.classList.add('hidden');
            admissionError.classList.add('hidden'); // Clear new error
            phoneError.classList.add('hidden');
            emailError.classList.add('hidden');
            departmentError.classList.add('hidden');

            if (studentNameInput.value.trim() === '') {
                nameError.classList.remove('hidden');
                isValid = false;
            }
            if (admissionNumberInput.value.trim() === '') { // New validation
                admissionError.classList.remove('hidden');
                isValid = false;
            }
            if (!validatePhoneNumber(phoneNumberInput.value.trim())) {
                phoneError.classList.remove('hidden');
                isValid = false;
            }
            if (!validateEmail(emailInput.value.trim())) {
                emailError.classList.remove('hidden');
                isValid = false;
            }
            if (departmentSelect.value === '') {
                departmentError.classList.remove('hidden');
                isValid = false;
            }

            return isValid;
        }

        /**
         * Populates the department dropdown with data from `minorCoursesData`.
         */
        function loadDepartments() {
            const currentSelectedDept = departmentSelect.value;
            departmentSelect.innerHTML = '<option value="">-- Choose your department --</option>'; // Updated placeholder

            minorCoursesData.forEach(data => {
                const option = document.createElement('option');
                option.value = data.department;
                option.textContent = data.department;
                departmentSelect.appendChild(option);
            });

            if (currentSelectedDept && minorCoursesData.some(d => d.department === currentSelectedDept)) {
                departmentSelect.value = currentSelectedDept;
            }
        }

        /**
         * Sets up all event listeners for UI interactions.
         */
        function setupUI() {
            messageBoxClose.addEventListener('click', hideMessage);
            loadDepartments(); // Populate department dropdown on initial load

            // Handle department selection change
            departmentSelect.addEventListener('change', () => {
                // Store current form inputs
                studentInfo.name = studentNameInput.value.trim();
                studentInfo.admissionNumber = admissionNumberInput.value.trim(); // Store new field
                studentInfo.phoneNumber = phoneNumberInput.value.trim();
                studentInfo.email = emailInput.value.trim();
                studentInfo.department = departmentSelect.value;

                if (studentInfo.department === "") {
                    courseSelectionSection.classList.add('hidden'); // Hide course section if no department selected
                    return;
                }

                if (validateForm()) {
                    selectedDepartment = studentInfo.department;
                    studentDetailsForm.classList.add('hidden');
                    courseSelectionSection.classList.remove('hidden');
                    displayAvailableCourses();
                } else {
                    showMessage("Validation Error", "Please fill in all your personal details correctly before selecting a department.", true);
                    // Reset department selection if validation fails, prompting user to re-select after fixing details
                    departmentSelect.value = "";
                }
            });

            submitBtn.addEventListener('click', async () => {
                if (selectedCourses.length === 2) {
                    await submitSelection();
                } else {
                    showMessage("Selection Error", "Please select exactly two minor courses.", true);
                }
            });

            changeOptionsBtn.addEventListener('click', () => {
                selectedCourses = []; // Reset selections
                displayAvailableCourses(); // Re-render to show all options based on current department
            });

            changeDepartmentBtn.addEventListener('click', () => {
                // Go back to the student details form
                studentDetailsForm.classList.remove('hidden');
                courseSelectionSection.classList.add('hidden');
                submissionMessage.classList.add('hidden');
                selectedCourses = []; // Clear course selections when changing department
                loadDepartments(); // Re-populate departments to ensure state consistency
            });

            printBtn.addEventListener('click', () => {
                preparePrintArea();
                window.print(); // Directly opens the print dialog
            });
        }

        /**
         * Displays all available minor courses, explicitly excluding those from the student's own department.
         */
        function displayAvailableCourses() {
            availableCoursesDiv.innerHTML = ''; // Clear previous courses

            const studentDeptCourses = minorCoursesData.find(data => data.department === selectedDepartment)?.minors || [];

            // Get all unique minor courses from the dataset
            let allUniqueMinorCourses = new Set();
            minorCoursesData.forEach(data => {
                data.minors.forEach(minor => allUniqueMinorCourses.add(minor));
            });

            // Filter out courses offered by the student's own department
            const eligibleMinorCourses = Array.from(allUniqueMinorCourses).filter(course =>
                !studentDeptCourses.includes(course)
            );

            // Sort eligible courses alphabetically for consistent display
            eligibleMinorCourses.sort();

            if (eligibleMinorCourses.length === 0) {
                availableCoursesDiv.innerHTML = '<p class="text-center text-gray-500 text-lg py-8">No minor courses available for selection from other departments.</p>';
                submitBtn.classList.add('hidden');
                changeOptionsBtn.classList.add('hidden');
                return;
            }

            eligibleMinorCourses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.classList.add('course-card');
                courseCard.dataset.courseName = course; // Store course name for easy lookup

                // Add course name and department to the card
                const courseNameDiv = document.createElement('div');
                courseNameDiv.classList.add('course-name');
                courseNameDiv.textContent = course;

                const offeredByDiv = document.createElement('div');
                offeredByDiv.classList.add('offered-by');
                offeredByDiv.textContent = `Offered by: ${courseToDepartmentMap[course] || 'N/A'}`; // Show offering department

                courseCard.appendChild(courseNameDiv);
                courseCard.appendChild(offeredByDiv);

                courseCard.addEventListener('click', () => toggleCourseSelection(courseCard, course));
                availableCoursesDiv.appendChild(courseCard);
            });
            updateCourseCardStates(); // Initial state update for selected/hidden cards
        }

        /**
         * Toggles the selection state of a course.
         * @param {HTMLElement} cardElement - The DOM element of the course card.
         * @param {string} courseName - The name of the course.
         */
        function toggleCourseSelection(cardElement, courseName) {
            const index = selectedCourses.indexOf(courseName);

            if (index > -1) {
                // Course already selected, deselect it
                selectedCourses.splice(index, 1);
                cardElement.classList.remove('selected');
            } else {
                // Course not selected, try to select it
                if (selectedCourses.length < 2) {
                    selectedCourses.push(courseName);
                    cardElement.classList.add('selected');
                } else {
                    showMessage("Selection Limit", "You can only select two minor courses.", true);
                }
            }
            updateCourseCardStates(); // Update UI after selection change
        }

        /**
         * Updates the visual state of all course cards (selected/deselected).
         * Also controls the visibility of submit/change options buttons.
         */
        function updateCourseCardStates() {
            const courseCards = availableCoursesDiv.querySelectorAll('.course-card');

            // Step 1: Update selected/deselected visual states
            courseCards.forEach(card => {
                const courseName = card.dataset.courseName;
                if (selectedCourses.includes(courseName)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            // Step 2: Manage visibility based on selection count
            if (selectedCourses.length === 2) {
                // If two courses are selected, hide all unselected cards
                courseCards.forEach(card => {
                    if (!card.classList.contains('selected')) {
                        card.classList.add('hidden'); // Hide unselected cards
                    }
                }
                );
                submitBtn.classList.remove('hidden');
                changeOptionsBtn.classList.remove('hidden');
            } else {
                // If less than two courses are selected, ensure all eligible cards are visible
                courseCards.forEach(card => {
                    card.classList.remove('hidden'); // Show all cards again
                });
                submitBtn.classList.add('hidden');
                changeOptionsBtn.classList.add('hidden');
            }
        }

        /**
         * Handles the submission of the selected courses to Google Sheet.
         * Displays a success message and transitions to the confirmation view.
         */
        async function submitSelection() {
            // Replace this with your actual Google Apps Script Web App URL
            const googleAppsScriptURL = 'https://script.google.com/macros/s/AKfycbxhX6NQWcjYsUqxODxJ1M4s_CQSNtYng1I4v53fV-JX1297VHohVxJwlVu-Dz_b1nIIhw/exec';

            const submissionDetails = {
                name: studentInfo.name,
                admissionNumber: studentInfo.admissionNumber, // Add new field to submission
                phoneNumber: studentInfo.phoneNumber,
                email: studentInfo.email,
                department: studentInfo.department,
                selectedMinors: selectedCourses,
            };

            try {
                // No explicit "Submitting..." message, as per request for simpler submission
                const response = await fetch(googleAppsScriptURL, {
                    method: 'POST',
                    mode: 'no-cors', // Use 'no-cors' for simple requests to Google Apps Script from client-side
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionDetails),
                });

                // In 'no-cors' mode, response.ok will always be true and response.status will be 0.
                // We assume success if no network error occurred.

                // Directly transition to success message and update printable area
                courseSelectionSection.classList.add('hidden');
                submissionMessage.classList.remove('hidden');
                updatePrintableArea(submissionDetails);

                showMessage("Success!", "Your minor course selection has been submitted successfully to the college.", false);
                console.log("Submission initiated. Check your Google Sheet for data.");


            } catch (error) {
                console.error("Error submitting data to Google Sheet:", error);
                showMessage("Submission Failed", "There was an error submitting your selection. Please check your internet connection and the Apps Script URL. " + error.message, true);
            }
        }

        /**
         * Populates the printable area with the student's details and selected courses.
         * @param {Object} data - The student's submission data.
         */
        function updatePrintableArea(data) {
            document.getElementById('printName').textContent = data.name;
            document.getElementById('printAdmissionNumber').textContent = data.admissionNumber; // Update new field in print
            document.getElementById('printPhone').textContent = data.phoneNumber;
            document.getElementById('printEmail').textContent = data.email;
            document.getElementById('printDepartment').textContent = data.department;

            const printCoursesList = document.getElementById('printCourses');
            printCoursesList.innerHTML = '';
            data.selectedMinors.forEach(course => {
                const li = document.createElement('li');
                li.textContent = course;
                printCoursesList.appendChild(li);
            });
        }

        /**
         * Prepares the printable area by making it visible and hiding other sections.
         */
        function preparePrintArea() {
            // This function is only for preparing the DOM for printing
            printableArea.classList.remove('hidden');
            studentDetailsForm.classList.add('hidden');
            courseSelectionSection.classList.add('hidden');
            // Keep submission message visible for context during print
            submissionMessage.classList.remove('hidden');
        }

        // Initialize the UI when the page loads
        window.addEventListener('load', setupUI);
    </script>
</body>
</html>
